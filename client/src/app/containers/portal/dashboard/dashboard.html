<page-header
	class="block mb-4"
	title="Dashboard"
	linkToWiki="https://wiki.go.akamai-access.com/display/BI/Page%3A+Dashboard">
</page-header>

<div *ngIf="!showContent">
	<h4>Welcome to the Galaxy Admin portal, {{userName}}</h4>
	<p>Please use the menu on the left side.</p>
</div>

<section
	[ngClass]="{
		'd-flex': showContent,
		'd-none': !showContent
	}"
	class="flex-column flex-xxl-row flex-wrap justify-content-between">

	<div class="col-xxl-6">
		<cloud-watch-widgets-metric-data></cloud-watch-widgets-metric-data>
	</div>

	<div class="col-xxl-6">
		<div
			e2e="alarms-section"
			class="card mt-3 mt-xl-0">

			<div class="card-header bg-transparent d-flex align-items-center justify-content-between">
				<div
					e2e="alarms-count"
					class="text-danger d-none"
					[class.d-none]="!alarms.alarmLambdaItems.length && !alarms.cloudWatchAlarmItems.length && !alarms.alarmPipelineErrorsItems.length || alarms.loading">

					<i class="fa fa-bell animation-bell fa-lg mr-2"></i>
					<b>Alarms: {{alarms.alarmLambdaItems.length + alarms.cloudWatchAlarmItems.length + alarms.alarmPipelineErrorsItems.length}}</b>
				</div>

				<div
					e2e="no-alarms"
					class="text-success d-none"
					[class.d-none]="alarms.alarmLambdaItems.length || alarms.cloudWatchAlarmItems.length || alarms.alarmPipelineErrorsItems.length || alarms.loading">

					<i class="fa fa-check-circle fa-lg mr-2"></i>
					<b>No alarms</b>
				</div>

				<div
					class="text-info"
					[class.d-none]="!alarms.loading">

					<b>Checking...</b>
				</div>

				<div class="text-right">
					<button
						type="button"
						[disabled]="alarms.loading"
						class="btn btn-link mt-1 mb-1 background-none border-0 cursor-pointer pre-wrap-text"
						(click)="fetchAlarmsList()">

						<i
							e2e="refresh"
							class="fa fa-refresh"
							[class.fa-spin]="alarms.loading">
						</i>
					</button>
				</div>
			</div>
			<div
				e2e="section-body"
				class="card-body p-0">

				<alarms-widget></alarms-widget>
			</div>

			<div
				*permissions="{ container: containers.S3_ALARMS_CONFIGS, permissions: [permission.VIEW] }"
				class="d-none card-footer p-2 align-items-center small"
				[class.d-flex]="alarms.alarmLambdaItems.length || alarms.cloudWatchAlarmItems.length">

				<span class="mr-2">See all alarms:</span>

				<a
					e2e="s3"
					class="link"
					[class.disabled]="alarms.loading"
					[class.d-none]="!alarms.alarmLambdaItems.length"
					[routerLink]="['/portal', 'configs', 'alarms']"
					[queryParams]="{'status': 'ALARM'}">

					S3
				</a>

				<span
					class="mr-2 ml-2"
					[class.d-none]="!alarms.alarmLambdaItems.length || !alarms.cloudWatchAlarmItems.length">
					|
				</span>

				<a
					e2e="cloudwatch"
					class="link"
					href="https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#alarm:alarmFilter=ANY​​​​​​​"
					target="_blank"
					[class.disabled]="alarms.loading"
					[class.d-none]="!alarms.cloudWatchAlarmItems.length">

					CloudWatch
				</a>
			</div>
		</div>
	</div>

	<div class="col">
		<cloud-watch-widgets-image></cloud-watch-widgets-image>
	</div>
</section>
