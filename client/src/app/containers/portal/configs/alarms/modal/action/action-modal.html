<div class="modal-header d-flex align-items-center">
	<h4 class="modal-title pull-left">{{title}}</h4>
	<button
		class="close pull-right"
		type="button"
		(click)="bsModalRef.hide()">

		<span aria-hidden="true">&times;</span>
	</button>
</div>

<div class="modal-body">
	<form
		class="mt-2 mb-2"
		[formGroup]="actionForm"
		(ngSubmit)="submit()">

		<div class="form-group d-flex flex-column">
			<label>Bucket:</label>

			<dropdown-item-picker
				#bucketList
				class="block w-100"
				[class.is-invalid]="!isBucketValid"
				[fixedWidth]="false"
				[data]="bucketListDropdown"
				(paramsChanged)="changeBucket($event[0].name)">
			</dropdown-item-picker>

			<div *ngIf="!isBucketValid" class="d-block invalid-feedback">
				Bucket is required
			</div>
		</div>

		<div class="form-group d-flex flex-column">
			<label>Source Prefix:</label>
			<input
					class="form-control"
					formControlName="sourcePrefix"
					type="text"
					[ngClass]="{ 'is-invalid': submitted && form.sourcePrefix.errors }">

			<div *ngIf="submitted && form.sourcePrefix.errors" class="invalid-feedback">
				<div *ngIf="form.sourcePrefix.errors.required">Source Prefix is required</div>
			</div>
		</div>

		<div class="form-group d-flex flex-column">
			<label>
				Check time (cron exp. in UTC time zone):
			</label>
			<div class="small text-muted">
				When to check the file and fire an alarm if file is not there. See
				<a target="_blank" href="http://www.cronmaker.com/">
					www.cronmaker.com
				</a>Â 
			</div>
			<input
				class="form-control"
				formControlName="cronExpression"
				type="text"
				[class.is-invalid]="submitted && form.cronExpression.errors">

			<div *ngIf="submitted && form.cronExpression.errors" class="invalid-feedback">
				<div *ngIf="form.cronExpression.errors.required">
					Check time is required
				</div>
			</div>

			<div
				*ngIf="currentConfig.cronDescription && !form.cronExpression.errors"
				class="small mt-2 text-success"
				[class.text-danger]="currentConfig.cronDescription == 'An error occured when generating the expression description.  Check the cron expression syntax.'">

				<b>Description: {{currentConfig.cronDescription}}</b>
			</div>
		</div>

		<div class="form-group d-flex">
			<div class="col-7 p-0 pr-1 d-flex flex-column">
				<label>Maximum file age (hours):</label>
					<div class="small text-muted">
						Helps to distinguish a new file from older files.
					</div>
					<input
						class="form-control"
						formControlName="durationHours"
						type="number"
						[class.is-invalid]="submitted && form.durationHours.errors">

					<div *ngIf="submitted && form.durationHours.errors" class="invalid-feedback">
						<div *ngIf="form.durationHours.errors.required">Maximum file age is required</div>
					</div>
			</div>
		</div>

		<div class="form-group d-flex flex-column">
			<label>Custom SNS topic ARN (optional):</label>
			<div class="small text-muted">
				Send additional message to this topic.
			</div>

			<input
				class="form-control"
				formControlName="customSnsTopicArn"
				type="text"
				[class.is-invalid]="submitted && form.customSnsTopicArn.errors">

			<div *ngIf="submitted && form.customSnsTopicArn.errors" class="invalid-feedback">
				<div *ngIf="form.customSnsTopicArn.errors.pattern">SNS topic ARN should match pattern 'arn:aws:sns:[region]:[account id]:[topic name]'
				</div>
			</div>

		</div>

		<div
			class="alert alert-warning mb-0"
			[class.d-none]="!isOverwriteConfig || isCheckingConfig">

			<p class="mb-3 small">
				A configuration with the same <b>bucket</b> and <b>sourcePrefix</b> already exists.
				Do you want to overwrite it?

				<button
					class="btn btn-link p-0 ml-1"
					type="button"
					(click)="isCollapsedInfo = !isCollapsedInfo">

					More info

					<i
						class="fa small fa-fw"
						[ngClass]="{
							'fa-caret-down': !isCollapsedInfo,
							'fa-caret-up': isCollapsedInfo
						}">
					</i>
				</button>
			</p>

			<div
				class="well well-lg card card-block card-header mb-3 small"
				[collapse]="!isCollapsedInfo">

				<div class="mb-1">
					Bucket: <b>{{overwritedConfig.bucket}}</b>
				</div>

				<div class="mb-1">
					Source prefix: <b>{{overwritedConfig.sourcePrefix}}</b>
				</div>

				<div class="d-flex w-100 mb-1">
					<div class="col-6 p-0 pr-1">
						Check time: <b>{{overwritedConfig.cronExpression}}</b>
					</div>
					<div class="col-6 p-0 pl-1">
						Maximum file age: <b>{{overwritedConfig.durationHours}}</b>
					</div>
				</div>

				<div class="d-flex w-100 mb-1">
					<div class="col-6 p-0 pr-1">
						Last check date: <br>
						<b>{{overwritedConfig.lastCheckDate}}</b>
					</div>
					<div class="col-6 p-0 pl-1">
						Next check date: <br>
						<b>{{overwritedConfig.nextCheckDate}}</b>
					</div>
				</div>

				<div class="d-flex w-100 mb-1">
					<div class="col-6 p-0 pr-1">
						Current status: <b>{{overwritedConfig.currentStatus}}</b>
					</div>
				</div>
			</div>

			<div class="form-group form-check mb-0">
				<input
					id="confirmOverwriteConfig"
					class="form-check-input cursor-pointer"
					formControlName="confirmOverwriteConfig"
					type="checkbox"
					[class.is-invalid]="submitted && form.confirmOverwriteConfig.errors">

				<label
					class="form-check-label cursor-pointer text-dark"
					for="confirmOverwriteConfig">

					Yes, I want to overwrite
				</label>

				<div *ngIf="submitted && form.confirmOverwriteConfig.errors" class="invalid-feedback">
					<div *ngIf="form.confirmOverwriteConfig.errors.required">
						Confirmation required
					</div>
				</div>
			</div>
		</div>

		<div class="text-danger small"
			[class.d-none]="!isShowCopyInvalidMsg">

			<b>In copy mode, you  need to change one of the parameters: bucket or source prefix</b>
		</div>

		<div class="text-center relative">
			<p
				class="text-info w-100 small absolute"
				[class.d-none]="!isCheckingConfig">

				<b>Checking configuration...</b>
			</p>

			<div class="btn-group mt-4">
				<button
					class="btn btn-success"
					type="submit">

					{{textControlBtn}}
				</button>
				<button
					type="button"
					class="btn btn-danger"
					(click)="cancel()">

					Cancel
				</button>
			</div>
		</div>
	</form>
</div>
