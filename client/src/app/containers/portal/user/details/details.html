<div class="d-flex justify-content-center">
	<div class="w-75">
		<div class="d-flex mb-4 mt-4">
			<h1
				e2e="title"
				class="page-title mb-3">
				User Details
			</h1>
		</div>
		<div class="card">
			<div class="card-body">
				<div class="panel-body d-flex">
					<div class="d-flex align-items-center d-none d-xs-none d-lg-block col-lg-3">
						<img
							alt="User Logo"
							src="./../../../../../assets/i/default-user.png"
							class="img-circle img-responsive"/>
					</div>
					<div class="col-xs-12 col-lg-9 p-4">
						<h2>
							{{userName}}
						</h2>
						<div class="text-info">
							{{userEmail}}
						</div>
						<hr>
						<accordion *ngIf="availableResources.length">
							<accordion-group>
								<div class="card mb-1">
									<accordion-header class="card-header mb-0">
										<button class="btn p-0 d-flex w-100 bold">
											<b>Available features: {{ availableResources.length }}</b>
										</button>
									</accordion-header>

									<accordion-content>
										<div class="card-body p-0">
											<ng-container *ngTemplateOutlet="resources; context:{resources: availableResources}"></ng-container>
										</div>
									</accordion-content>
								</div>
							</accordion-group>
						</accordion>

						<accordion *ngIf="notAvailableResources.length">
							<accordion-group>
								<div class="card mb-1">
									<accordion-header class="card-header mb-0">
										<button class="btn p-0 d-flex w-100 bold">
											<b>Not available features: {{ notAvailableResources.length }}</b>
										</button>
									</accordion-header>

									<accordion-content>
										<div class="card-body p-0">
											<ng-container *ngTemplateOutlet="resources; context:{resources: notAvailableResources}"></ng-container>
										</div>
									</accordion-content>
								</div>
							</accordion-group>
						</accordion>

						<div
							*ngIf="isShowRequestPermissionBtn"
							class="mt-3">

							<button
								class="btn btn-primary rounded"
								(click)="openRequestPermissionModal()">

								Request permission
							</button>
						</div>

						<div class="log-out mt-4 d-none">
							<button
								[disabled]="logoutInProcess"
								class="btn btn-dark"
								type="button"
								(click)="logout()">

								<i class="fa fa-sign-out mr-2"></i>
								Logout
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<ng-template #resources let-resources="resources">
	<table class="table table-sm table-hover table-bordered m-0">
		<thead>
			<tr>
				<th
					rowspan="2"
					class="align-middle">

					Feature
				</th>
				<th
					colspan="4"
					class="align-middle text-center">

					Permissions
				</th>
			</tr>
			<tr>
				<th class="align-middle text-center">
					View
				</th>
				<th class="align-middle text-center">
					Update
				</th>
				<th class="align-middle text-center">
					Create
				</th>
				<th class="align-middle text-center">
					Delete
				</th>
			</tr>
		</thead>
		<tbody>
			<ng-container *ngFor="let item of resources">
				<tr *ngIf="item.resource !== containers.ANY">
					<td class="align-middle">
						{{ item.description }}
					</td>

					<ng-container *ngFor="let permission of item.permissions">
						<td
							*ngIf="permission.name !== permissionAction.ALL"
							class="align-middle text-center icon-column">

							<ng-container *ngIf="permission.allow && permission.exist">
								<i class="fa fa-check text-success"></i>
							</ng-container>

							<ng-container *ngIf="(permission.deny || !permission.allow) && permission.exist">
								<i class="fa fa-times text-danger"></i>
							</ng-container>

							<ng-container *ngIf="!permission.exist">
								-
							</ng-container>
						</td>
					</ng-container>
				</tr>
			</ng-container>
		</tbody>
	</table>
</ng-template>
