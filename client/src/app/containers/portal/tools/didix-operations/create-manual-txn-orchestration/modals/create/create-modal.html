<div class="modal-header d-flex flex-row align-items-top">
	<h5 class="mb-3">
		{{title}}
	</h5>

	<button
		class="close pull-right"
		type="button"
		(click)="bsModalRef.hide()">

		<i
			class="fa"
			[ngClass]="{
					'fa-times': !submitted,
					'fa-pulse fa-spinner fa-spin': submitted
				}">
		</i>
	</button>
</div>

<div class="modal-body">
	<form
		e2e="search-section"
		class="d-flex flex-column mb-2"
		[formGroup]="form"
		ngNativeValidate
		(keydown.enter)="$event.preventDefault()"
		(ngSubmit)="submit()">

		<div
			*ngIf="action !== modalActions.DELETE"
			class="d-flex flex-column">

			<div class="form-group flex-fill mb-3">
				<label for="redeemDate">
					<b>Redeem date</b>
				</label>

				<div class="d-flex pr-xl-2">
					<div class="form-group flex-fill m-0 p-0">
						<input
							type="text"
							id="redeemDate"
							class="form-control radius-none"
							[class.is-invalid]="form.get('redeemDate').touched && form.get('redeemDate').errors"
							name="date"
							placeholder="yyyy-mm-dd"
							readonly
							#bsDp="bsDatepicker"
							bsDatepicker
							triggers="keydown:click"
							[outsideClick]="true"
							formControlName="redeemDate"
							[bsConfig]="{useUtc: false, containerClass: 'theme-default', dateInputFormat: 'YYYY-MM-DD'}">
					</div>

					<div class="input-group-btn m-0 p-0">
						<button
							e2e="date-range-from"
							type="button"
							class="btn btn-default border radius-none"
							(click)="bsDp.toggle()">

							<i class="fa fa-calendar"></i>
						</button>
					</div>
				</div>

				<form-message [control]="form.get('redeemDate')"></form-message>
			</div>

			<div>
				<div class="form-group mb-3">
					<label class="w-100">
						<b>Product</b>

						<dropdown-item-picker
							e2e="event-type-dropdown"
							class="block w-100"
							placeholder="Select product"
							[fixedWidth]="false"
							[loading]="loadingProducts"
							[disabled]="submitted && !form.get('productId').errors"
							[class.is-invalid]="form.get('productId').touched && form.get('productId').errors"
							[dataObservable]="productsSubj"
							(paramsChanged)="changedProduct($event[0].value)">
						</dropdown-item-picker>
					</label>

					<form-message [control]="form.get('productId')"></form-message>
				</div>

				<div class="form-group mb-3">
					<label class="w-100">
						<b>Article</b>

						<dropdown-item-picker
							e2e="event-type-dropdown"
							class="block w-100"
							placeholder="Select article"
							[fixedWidth]="false"
							[loading]="loadingArticles"
							[disabled]="submitted || !form.get('productId').value"
							[class.is-invalid]="form.get('article').touched && form.get('article').errors"
							[dataObservable]="articlesSubj"
							(paramsChanged)="changedArticle($event[0].value)">
						</dropdown-item-picker>
					</label>

					<form-message [control]="form.get('article')"></form-message>
				</div>
			</div>


			<div class="form-group mb-3">
				<label class="w-100">
					<b>Redeem Amount</b>
					<input
						type="number"
						placeholder="00.00"
						step="any"
						class="form-control block"
						formControlName="redeemAmt"
						[class.is-invalid]="form.get('redeemAmt').touched && form.get('redeemAmt').errors">
				</label>

				<form-message
					[control]="form.get('redeemAmt')"
					[customErrorMessage]="'Max 2 decimal places'">
				</form-message>
			</div>

			<div class="form-group mb-3">
				<label class="w-100">
					<b>Redemption Point</b>

					<dropdown-item-picker
						e2e="event-type-dropdown"
						class="block w-100"
						placeholder="Select creditor"
						[fixedWidth]="false"
						[loading]="loadingCreditors"
						[disabled]="submitted && !form.get('creditor').errors"
						[class.is-invalid]="form.get('creditor').touched && form.get('creditor').errors"
						[dataObservable]="creditorsSubj"
						(paramsChanged)="changedCreditor($event[0].value)">
					</dropdown-item-picker>
				</label>

				<form-message [control]="form.get('creditor')"></form-message>
			</div>
		</div>

		<div class="text-center">
			<div class="btn-group">
				<button
					type="submit"
					class="btn"
					[disabled]="submitted"
					[ngClass]="{
						'btn-danger': action === modalActions.DELETE,
						'btn-success': action !== modalActions.DELETE
					}">

					<ng-template
						[ngIf]="action === modalActions.DELETE"
						[ngIfElse]="elseBlock">

						Delete
					</ng-template>
					<ng-template #elseBlock>
						Submit
					</ng-template>
				</button>
			</div>
		</div>
	</form>
</div>
