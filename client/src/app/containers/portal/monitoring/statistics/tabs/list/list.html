<div class="table-responsive relative mb-3">
	<div *ngIf="loading">
		<div
			e2e="loading-shade"  
			class="bhn-loading-shade">
			<i
				e2e="loader"
				class="fa fa-pulse fa-spinner fa-2x"></i>
		</div>
	</div>

	<table
		e2e="monitoring-table"
		class="table table-hover margin-none">

		<thead>
			<tr e2e="monitoring-table-header">
				<th></th>
				<th>Source application</th>
				<th>Raw Files</th>
				<th>Events</th>
				<th class="relative">
					Latency
					<span
						class="btn-link border-0 ml-1 p-0"
						placement="bottom"
						tooltip="This is an avg value for 90% of files">
						<i 
							e2e="info-icon"
							class="fa fa-info-circle"></i>
					</span>
				</th>
				<th class="d-none text-center">Events in progress</th>
				<th class="text-center">Status</th>
				<th *ngIf="pipeline === pipelineType.BATCH"></th>
			</tr>
		</thead>

		<tbody
			e2e="monitoring-sources-row"
			*ngFor="let item of items; let i = index"
			class="table-row-group">

			<tr>
				<td>
					<a
						href="javascript:void(0)"
						class="p-2"
						(click)="toggleRow(item)">

						<i
							e2e="expander"
							class="fa"
							[class.fa-chevron-right]="!openedRow(item)"
							[class.fa-chevron-down]="openedRow(item)">
						</i>
					</a>
				</td>

				<td>
					<a
						e2e="source-application"
						[routerLink]="item.navigateTo"
						[queryParams]="item.queryParams">

						{{item.sourceApplication}}
					</a>
				</td>

				<td e2e="raw-files">
					{{item.rawFilesCount | number}}
				</td>

				<td e2e="events">
					{{item.eventsCount | number}}
				</td>

				<td e2e="latency">
					{{item.latencyAverage | timeFormat:'MICROSECOND'}}
				</td>

				<td
					e2e="panding-events"
					class="d-none text-center">

					{{item.pendingEvents | number}}
				</td>

				<td class="d-flex flex-column flex-xxl-row align-items-center justify-content-center text-center">
					<i
						e2e="success"
						*ngIf="!item.errorsCount && !item.missingConfigsCount"
						class="fa fa-check-circle text-success fa-2x">
					</i>

					<a
						*ngIf="!!item.errorsCount"
						class="text-danger inline-block p-1"
						title="Errors Count {{item.errorsCount}}"
						[routerLink]="item.navigateTo"
						[queryParams]="item.queryParams">

						<i
							e2e="error-mark"
							class="fa fa-times-circle text-danger fa-2x"
							aria-hidden="true">
						</i>

						<span
							e2e="errors-cunt"
							class="block">

							Errors: {{item.errorsCount | number}}
						</span>
					</a>

					<a
						*ngIf="!!item.missingConfigsCount"
						class="text-warning inline-block p-1"
						title="Missing Configurations {{item.missingConfigsCount}}"
						[routerLink]="['/portal', 'monitoring', 'missing-configurations']">

						<i 
							e2e="attention-mark"
							class="fa fa-exclamation-triangle fa-2x" 
							aria-hidden="true">
						</i>

						<span
							e2e="missing-configurations-count"
							class="block">

							Missing Configs: {{item.missingConfigsCount | number}}
						</span>
					</a>
				</td>

				<td 
					*ngIf="pipeline === pipelineType.BATCH"
					class="text-center">

					<a 
						href="javascript:void(0)"
						[routerLink]="['/portal', 'input-files']"
						[queryParams]="{'sourceApplication': item.sourceApplication}">
			
						Browse input files
					</a>
				</td>
			</tr>

			<tr *ngIf="openedRow(item)">
				<td
					colspan="8"
					class="border-none">

					<monitoring-event-types
						[sourceApplication]="item.sourceApplication"
						[queries]="queries">
					</monitoring-event-types>
				</td>
			</tr>
		</tbody>

		<tbody *ngIf="!items.length && !loading">
			<tr>
				<td
					e2e="no-data"
					colspan="6">
	
					No data.
				</td>
			</tr>
		</tbody>
	</table>
</div>

<div
	*ngIf="items && items.length && pagination.totalItems > pagination.itemsPerPage"
	class="row">

	<div class="col-12">
		<paginator
			[loading]="loading"
			[itemsPerPage]="pagination.itemsPerPage"
			[totalItems]="pagination.totalItems"
			[page]="pagination.page"
			(changed)="pageChanged($event.page)">
		</paginator>
	</div>
</div>
